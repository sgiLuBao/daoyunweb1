(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b9744a84"],{"4ec1":function(e,r,o){"use strict";o.d(r,"b",(function(){return t})),o.d(r,"c",(function(){return a})),o.d(r,"a",(function(){return n}));var s=o("a3a3");function t(e){return Object(s["a"])({url:"api/code/resetEmail?email="+e,method:"post"})}function a(e,r){return Object(s["a"])({url:"api/code/phoneCode?phoneNumber="+r,method:"post",data:e})}function n(e){return Object(s["a"])({url:"api/code/validated",method:"post",data:e})}},6914:function(e,r,o){"use strict";o("c1c4")},c1c4:function(e,r,o){},ffb0:function(e,r,o){"use strict";o.r(r);var s=function(){var e=this,r=e.$createElement,o=e._self._c||r;return o("div",{staticClass:"login_container"},[o("div",{staticClass:"login_box"},[e._m(0),e._v(" "),o("div",{staticClass:"login_header"},[o("span",{class:{active:0==e.cur},staticStyle:{padding:"0 20px"},on:{click:function(r){e.cur=0}}},[e._v("账号登录")]),e._v(" "),o("span",{class:{active:1==e.cur},staticStyle:{padding:"0 20px"},on:{click:function(r){e.cur=1}}},[e._v("手机号登录")])]),e._v(" "),o("el-form",{directives:[{name:"show",rawName:"v-show",value:1==e.cur,expression:"cur==1"}],ref:"loginform",staticClass:"login_form",attrs:{model:e.loginform,rules:e.loginrules,"label-width":"0px",autocomplete:"on"}},[o("el-form-item",{attrs:{prop:"username"}},[o("el-input",{attrs:{placeholder:"请输入手机号","prefix-icon":"el-icon-mobile-phone"},model:{value:e.loginform.username,callback:function(r){e.$set(e.loginform,"username",r)},expression:"loginform.username"}}),e._v(" "),o("el-button",{staticStyle:{position:"absolute",right:"0"},attrs:{type:"warning",disabled:e.resend},on:{click:function(r){return e.sendCode()}}},[e._v(e._s(e.codeStatus))])],1),e._v(" "),o("el-form-item",{attrs:{prop:"code"}},[o("el-input",{attrs:{placeholder:"请输入验证码","prefix-icon":"el-icon-chat-dot-round"},model:{value:e.loginform.password,callback:function(r){e.$set(e.loginform,"password",r)},expression:"loginform.password"}})],1),e._v(" "),o("el-form-item",[o("el-row",{attrs:{type:"flex",justify:"end"}},[o("el-col",{attrs:{span:12,offset:15}})],1)],1),e._v(" "),o("el-form-item",{staticClass:"btn"},[o("el-button",{staticStyle:{width:"450px"},attrs:{type:"primary",loading:e.loading,round:""},nativeOn:{click:function(r){return r.preventDefault(),e.handleLogin()}}},[e._v("登录")])],1)],1),e._v(" "),o("el-form",{directives:[{name:"show",rawName:"v-show",value:0==e.cur,expression:"cur==0"}],ref:"loginform_user",staticClass:"login_form",attrs:{model:e.loginform_user,rules:e.loginrules_user,"label-width":"0px",autocomplete:"on"}},[o("el-form-item",{attrs:{prop:"username"}},[o("el-input",{attrs:{placeholder:"请输入用户名","prefix-icon":"el-icon-user"},model:{value:e.loginform_user.username,callback:function(r){e.$set(e.loginform_user,"username",r)},expression:"loginform_user.username"}})],1),e._v(" "),o("el-form-item",{attrs:{prop:"password"}},[o("el-input",{attrs:{placeholder:"请输入密码","prefix-icon":"el-icon-unlock",type:"password"},model:{value:e.loginform_user.password,callback:function(r){e.$set(e.loginform_user,"password",r)},expression:"loginform_user.password"}})],1),e._v(" "),o("el-form-item",{staticClass:"btn"},[o("el-button",{staticStyle:{width:"450px"},attrs:{type:"primary",loading:e.loading,round:""},nativeOn:{click:function(r){return r.preventDefault(),e.handleLogin_byusername()}}},[e._v("登录")])],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"忘记密码",visible:e.dialogFormVisible,width:"50%","append-to-body":"","close-on-click-modal":!1,center:""},on:{"update:visible":function(r){e.dialogFormVisible=r}},scopedSlots:e._u([{key:"footer",fn:function(){return[o("span",{staticClass:"dialog-footer"},[o("el-button",{on:{click:function(r){return e.closeForm()}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.changePassword()}}},[e._v("确 定")])],1)]},proxy:!0}])},[o("el-form",{ref:"passwordform",attrs:{model:e.passwordform,rules:e.passwordrules}},[o("el-form-item",{attrs:{label:"邮箱","label-width":e.formLabelWidth,prop:"email"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.passwordform.email,callback:function(r){e.$set(e.passwordform,"email",r)},expression:"passwordform.email"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"验证码","label-width":e.formLabelWidth,prop:"code"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.passwordform.code,callback:function(r){e.$set(e.passwordform,"code",r)},expression:"passwordform.code"}}),e._v(" "),o("el-button",{staticStyle:{position:"absolute",right:"0"},attrs:{type:"warning",disabled:e.resend},on:{click:function(r){return e.sendCode()}}},[e._v(e._s(e.codeStatus))])],1),e._v(" "),o("el-form-item",{attrs:{label:"新密码","label-width":e.formLabelWidth,prop:"password"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.passwordform.password,callback:function(r){e.$set(e.passwordform,"password",r)},expression:"passwordform.password"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"确认密码","label-width":e.formLabelWidth,prop:"rePassword"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.passwordform.rePassword,callback:function(r){e.$set(e.passwordform,"rePassword",r)},expression:"passwordform.rePassword"}})],1)],1)],1)],1)},t=[function(){var e=this,r=e.$createElement,o=e._self._c||r;return o("div",{staticClass:"avater_box"},[o("h3",[e._v("到云签到")])])}],a=(o("6b54"),o("a78e")),n=o.n(a),i=o("83d6"),l=o.n(i),d=o("63d4"),u=o("104b"),c=o("4ec1"),m=o("4f98"),p={name:"Login",data:function(){var e=this,r=function(r,o,s){""===o?s(new Error("请再次输入密码")):o!==e.passwordform.password?s(new Error("两次输入密码不一致!")):s()},o=function(r,o,s){""===o?s(new Error("请再次输入验证码")):o!=e.truecode?s(new Error("验证码输入错误!")):s()};return{loginform:{username:"18750062313",password:""},loginform_user:{username:"admin",password:"123456"},loginrules:{username:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^((0\d{2,3}-\d{7,8})|(1[3584]\d{9}))$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,validator:o,trigger:"blur"}]},loginrules_user:{username:[{required:!0,message:"请输入手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},dialogFormVisible:!1,passwordform:{email:"",code:"",password:"",rePassword:""},passwordrules:{email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^([a-zA-Z0-9]+[-_\.]?)+@[a-zA-Z0-9]+\.[a-z]+$/,message:"请输入正确的邮箱",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:4,message:"请输入正确的验证码",trigger:"blur"}],password:[{required:!0,message:"请输入新密码",trigger:"blur"},{pattern:/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$)([^\u4e00-\u9fa5\s]){6,15}$/,message:"密码为数字，字母或特殊符号至少包含两种，长度为6 - 15位"}],rePassword:[{required:!0,validator:r,trigger:"blur"}]},formLabelWidth:"120px",cookiePass:"",loading:!1,passwordType:"password",redirect:void 0,activeName:"username",codeStatus:"获取验证码",resend:!1,truecode:"123456",cur:1}},watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect},immediate:!0}},created:function(){this.getCookie()},methods:{getCookie:function(){var e=n.a.get("username"),r=n.a.get("password");this.cookiePass=void 0===r?"":r,r=void 0===r?this.loginForm.password:r,this.loginForm={username:void 0===e?this.loginForm.username:e,password:r}},closeForm:function(){this.dialogFormVisible=!1},sendCode:function(){var e=this;if(this.loginform.username){this.resend=!this.resend;var r=60,o=r;this.codeStatus=o.toString()+"秒";var s=this.loginform.username,t={phone:this.loginform.username},a=setInterval((function(){o>0&&o<=r?(o--,e.codeStatus=o.toString()+"秒"):(e.codeStatus="获取验证码",e.resend=!e.resend,clearInterval(a),a=null)}),1e3);Object(c["c"])(t,s).then((function(r){e.truecode=r,console.log(r),e.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"})})).catch((function(r){console.log(r),e.codeStatus="获取验证码",e.resend=!e.resend,clearInterval(a),a=null}))}else this.$message({showClose:!0,message:"请输入手机号",type:"error"})},changePassword:function(){var e=this;this.$refs.passwordform.validate((function(r){e.passwordform.password=Object(d["a"])(e.passwordform.password);var o={code:e.passwordform.code,type:"email",scenes:"重置密码",value:e.passwordform.email};Object(c["a"])(o).then((function(o){if(r){var s={email:e.passwordform.email,password:e.passwordform.password};Object(u["a"])(s).then((function(r){e.closeForm(),Object(m["b"])(),n.a.remove("password")}))}})).catch((function(){e.$message({message:"验证码错误",type:"warning"})}))}))},handleLogin:function(){var e=this;this.$refs.loginform.validate((function(r){var o={username:e.loginform.username,phone:e.loginform.username};r&&(e.loading=!0,n.a.set("username",o.username,{expires:l.a.passCookieExpires}),e.$store.dispatch("user/loginbyphone",o).then((function(){console.log("login请求成功"),e.$router.push({path:e.redirect||"/"}),e.loading=!1})).catch((function(r){e.loading=!1})))}))},handleLogin_byusername:function(){var e=this;this.$refs.loginform_user.validate((function(r){var o={username:e.loginform_user.username,password:e.loginform_user.password};o.password!==e.cookiePass&&(o.password=Object(d["a"])(o.password)),r&&(e.loading=!0,n.a.set("username",o.username,{expires:l.a.passCookieExpires}),n.a.set("password",o.password,{expires:l.a.passCookieExpires}),e.$store.dispatch("user/login",o).then((function(){console.log("login请求成功"),e.$router.push({path:e.redirect||"/"}),e.loading=!1})).catch((function(r){e.loading=!1})))}))}}},f=p,g=(o("6914"),o("2877")),w=Object(g["a"])(f,s,t,!1,null,"62b3193b",null);r["default"]=w.exports}}]);