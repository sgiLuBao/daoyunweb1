(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9c7b44d4"],{"386d":function(e,t,a){"use strict";var n=a("cb7c"),i=a("83a1"),l=a("5f1b");a("214f")("search",1,(function(e,t,a,r){return[function(a){var n=e(this),i=void 0==a?void 0:a[t];return void 0!==i?i.call(a,n):new RegExp(a)[t](String(n))},function(e){var t=r(a,e,this);if(t.done)return t.value;var o=n(e),s=String(this),c=o.lastIndex;i(c,0)||(o.lastIndex=0);var d=l(o,s);return i(o.lastIndex,c)||(o.lastIndex=c),null===d?-1:d.index}]}))},5146:function(e,t,a){"use strict";a("e015")},"5ffc":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"d",(function(){return l})),a.d(t,"c",(function(){return s}));var n=a("a3a3");function i(){return Object(n["a"])({url:"api/roles/all",method:"get"})}function l(e){return Object(n["a"])({url:"api/roles",method:"get",params:e})}function r(e){return Object(n["a"])({url:"api/roles",method:"post",data:e})}function o(e){return Object(n["a"])({url:"api/roles/"+e,method:"get"})}function s(){return Object(n["a"])({url:"api/roles/level",method:"get"})}function c(e){return Object(n["a"])({url:"api/roles",method:"delete",data:e})}function d(e){return Object(n["a"])({url:"api/roles",method:"put",data:e})}function u(e){return Object(n["a"])({url:"api/roles/menu",method:"put",data:e})}t["a"]={getList:l,add:r,edit:d,del:c,get:o,editMenu:u,getLevel:s}},"615c":function(e,t,a){"use strict";a("c6d8")},8089:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-card",{staticClass:"box-card"},[a("el-row",[a("span",[e._v("昵称或用户名：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入昵称或用户名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("el-button",{on:{click:e.resetData}},[e._v("\n            重置")])],1),e._v(" "),a("el-row",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("添加")]),e._v(" "),a("el-button",{attrs:{disabled:0===e.ids.length,type:"danger",size:"small"},on:{click:function(t){e.deleteVisible=!0}}},[e._v("删除")])],1),e._v(" "),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id","row-class-name":e.tableRowClassName},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"nickName",label:"昵称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名",width:"155"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dept.name",label:"院校"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s("1"===t.row.type.toString()?"员工":"教师"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"gender",label:"性别"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"电话",width:"135"}}),e._v(" "),a("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"165"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-row",[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":e.pagesizes,"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.visible,width:"650px","show-close":!1,"destroy-on-close":!0},on:{"update:visible":function(t){e.visible=t}}},[a("el-col",{attrs:{span:22}},[a("el-form",{ref:"form",attrs:{inline:!0,model:e.form,rules:e.rules,size:"small","label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[a("el-input",{model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"电话",prop:"phone"}},[a("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",e._n(t))},expression:"form.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"院校",prop:"dept.id"}},[a("treeselect",{staticStyle:{width:"185px"},attrs:{options:e.depts,"load-options":e.loadDepts,placeholder:"选择院校"},model:{value:e.form.dept.id,callback:function(t){e.$set(e.form.dept,"id",t)},expression:"form.dept.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"性别",prop:"gender"}},[a("el-radio-group",{staticStyle:{width:"150px"},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[a("el-radio",{attrs:{label:"男"}},[e._v("男")]),e._v(" "),a("el-radio",{attrs:{label:"女"}},[e._v("女")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"角色",prop:"roles"}},[a("el-select",{staticStyle:{width:"185px"},attrs:{multiple:"",placeholder:"请选择"},on:{"remove-tag":e.deleteTag,change:e.changeRole},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roles,(function(t){return a("el-option",{key:t.name,attrs:{disabled:1!==e.level&&t.level<=e.level,label:t.name,value:t.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{staticStyle:{width:"150px"},model:{value:e.form.enabled,callback:function(t){e.$set(e.form,"enabled",t)},expression:"form.enabled"}},[a("el-radio",{attrs:{label:"true"}},[e._v("启用")]),e._v(" "),a("el-radio",{attrs:{label:"false"}},[e._v("停用")])],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:e.closeForm}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"确认删除",visible:e.deleteVisible,width:"400px","show-close":!1,"destroy-on-close":!0},on:{"update:visible":function(t){e.deleteVisible=t}}},[a("el-col",{attrs:{span:22}},[a("span",[e._v("确认删除选中项？")])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.deleteData}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:e.closeForm}},[e._v("取 消")])],1)],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("用户所在院校/部门")])]),e._v(" "),a("div",{staticClass:"head-container"},[a("el-input",{staticClass:"filter-item",attrs:{clearable:"",size:"small",placeholder:"输入院校/部门名称搜索","prefix-icon":"el-icon-search"},on:{input:e.getDeptDatas},model:{value:e.deptName,callback:function(t){e.deptName=t},expression:"deptName"}})],1),e._v(" "),a("el-tree",{attrs:{data:e.depts,load:e.getDeptDatas,props:e.defaultProps,"expand-on-click-node":!1,"highlight-current":!0,lazy:""},on:{"node-click":e.handleNodeClick}})],1)],1)],1)],1)},i=[],l=a("53ca"),r=(a("ac6a"),a("6b54"),a("386d"),a("7f7f"),a("ee16")),o=a("af36"),s=a("5ffc"),c=a("ca17"),d=a.n(c),u=(a("542c"),a("5c96")),f={name:"User",components:{Treeselect:d.a},data:function(){return{dialogTitle:"",visible:!1,disabled:!0,deleteVisible:!1,total:0,name:"",deptName:"",deptId:null,defaultProps:{children:"children",label:"name",isLeaf:"leaf"},pagesizes:[5,10,15,20],pagesize:5,currentPage:1,listLoading:!0,tableData:[],defaultForm:{id:null,username:null,nickName:null,gender:"男",type:2,email:null,enabled:"false",roles:[],jobs:[],dept:{id:null},phone:null},form:null,row:null,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],nickName:[{required:!0,message:"请输入昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^((0\d{2,3}-\d{7,8})|(1[3584]\d{9}))$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{pattern:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,message:"请输入正确的邮箱",trigger:"blur"}],"dept.id":[{required:!0,message:"请选择院校",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"blur"}]},depts:[],roles:[],level:3,userRoles:[],ids:[]}},created:function(){this.fetchData(),this.form=JSON.parse(JSON.stringify(this.defaultForm)),this.row=JSON.parse(JSON.stringify(this.defaultForm))},methods:{fetchData:function(){var e=this;this.listLoading=!0,this.ids=[];var t=this.currentPage-1,a=this.pagesize,n="id,desc",i=this.name,l=this.deptId,o=null;o={page:t,size:a,sort:n,blurry:i,deptId:l},r["b"].get(o).then((function(t){e.tableData=t.content,e.total=t.totalElements,(e.currentPage-1)*e.pagesize>=e.total&&e.currentPage>1&&(e.currentPage-=1,e.fetchData()),e.listLoading=!1}))},search:function(){var e=this;if(0===this.name.length)this.$message("请输入搜索关键字！");else{this.listLoading=!0;var t=this.currentPage-1,a=this.pagesize,n="id,desc",i=this.name,l=this.deptId,o=null;o={page:t,size:a,sort:n,blurry:i,deptId:l},console.log(JSON.stringify(o)),r["b"].get(o).then((function(t){e.tableData=t.content,e.total=t.totalElements,(e.currentPage-1)*e.pagesize>=e.total&&e.currentPage>1&&(console.log("search tableData2 = "+e.currentPage),e.currentPage-=1,e.search()),e.listLoading=!1}))}},resetData:function(){this.listLoading=!0,this.currentPage=1,this.name="",this.deptId=null,this.fetchData()},update:function(){var e=this;this.$refs["form"].validate((function(t){if(t){if(!e.form.dept.id)return e.$message({message:"院校/部门不能为空",type:"warning"}),!1;if(0===e.form.roles.length)return e.$message({message:"角色不能为空",type:"warning"}),!1;56!==e.form.dept.id&&57!==e.form.dept.id||(e.form.type=1),e.form.roles=e.userRoles,e.listLoading=!0,null===e.form.id?r["b"].add(e.form).then((function(t){e.notifiSuccess("新增成功"),e.closeForm(),e.fetchData()})).catch((function(){e.notifiError("新增失败")})):r["b"].edit(e.form).then((function(t){e.notifiSuccess("编辑成功"),e.closeForm(),e.fetchData()})).catch((function(){e.notifiError("编辑失败")}))}}))},deleteData:function(){var e=this;r["b"].del(this.ids).then((function(t){e.notifiSuccess("删除成功"),e.fetchData()})).catch((function(){e.notifiError("删除失败")})),this.closeForm()},closeForm:function(){this.visible=!1,this.deleteVisible=!1,this.ids=[],this.form=JSON.parse(JSON.stringify(this.defaultForm))},handleSizeChange:function(e){this.pagesize=e,this.fetchData()},handleCurrentChange:function(e){console.log("当前页码改变了"+e),this.currentPage=e,this.fetchData()},handleAdd:function(){this.dialogTitle="添加用户",this.form=JSON.parse(JSON.stringify(this.defaultForm)),this.getRoles(),null===this.form.id?this.getDepts():this.getSupDepts(this.form.dept.id),this.getRoleLevel(),this.form.enabled=this.form.enabled.toString(),this.visible=!0},handleEdit:function(e,t){this.dialogTitle="编辑用户信息",this.form=JSON.parse(JSON.stringify(t)),this.getRoles(),null===this.form.id?this.getDepts():this.getSupDepts(this.form.dept.id),this.getRoleLevel(),this.form.enabled=this.form.enabled.toString();var a=[],n=[];this.form.roles.forEach((function(e,t){a.push(e.id);var i={id:e.id};n.push(i)})),this.userRoles=n,this.form.roles=a,this.visible=!0},handleDelete:function(e,t){this.form=JSON.parse(JSON.stringify(t)),this.ids=[this.form.id],this.deleteVisible=!0},getDeptDatas:function(e,t){var a=this,n="id,desc",i={sort:n};"object"!==Object(l["a"])(e)?e&&(i["name"]=e):0!==e.level&&(i["pid"]=e.data.id),setTimeout((function(){Object(o["c"])(i).then((function(e){t?t(e.content):a.depts=e.content}))}),100)},getDepts:function(){var e=this;Object(o["c"])({enabled:!0}).then((function(t){e.depts=t.content.map((function(e){return e.hasChildren&&(e.children=null),e}))}))},getSupDepts:function(e){var t=this;Object(o["b"])(e).then((function(e){var a=e.content;t.buildDepts(a),t.depts=a}))},buildDepts:function(e){var t=this;e.forEach((function(e){e.children&&t.buildDepts(e.children),e.hasChildren&&!e.children&&(e.children=null)}))},loadDepts:function(e){var t=e.action,a=e.parentNode,n=e.callback;t===c["LOAD_CHILDREN_OPTIONS"]&&Object(o["c"])({enabled:!0,pid:a.id}).then((function(e){a.children=e.content.map((function(e){return e.hasChildren&&(e.children=null),e})),setTimeout((function(){n()}),200)}))},getRoles:function(){var e=this;Object(s["b"])().then((function(t){e.roles=t})).catch((function(){}))},getRoleLevel:function(){var e=this;Object(s["c"])().then((function(t){e.level=t.level})).catch((function(){}))},changeRole:function(e){var t=[];e.forEach((function(e,a){var n={id:e};t.push(n)})),this.userRoles=t},deleteTag:function(e){this.userRoles.forEach((function(t,a){t.id===e&&this.userRoles.splice(a,e)}))},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"false"===t.enabled.toString()?"warning-row":""},handleSelectionChange:function(e){var t=[];e.forEach((function(e){t.push(e.id)})),this.ids=t},handleNodeClick:function(e){0===e.pid?this.deptId=null:this.deptId=e.id,this.fetchData()},notifiSuccess:function(e){u["Notification"].success({title:e,duration:4e3})},notifiError:function(e){u["Notification"].error({title:e,duration:4e3})}}},p=f,h=(a("5146"),a("615c"),a("2877")),m=Object(h["a"])(p,n,i,!1,null,"4055a980",null);t["default"]=m.exports},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},af36:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return l}));a("e804");var n=a("a3a3");function i(e){return Object(n["a"])({url:"api/dept",method:"get",params:e})}function l(e){var t=e.length||0===e.length?e:Array.of(e);return Object(n["a"])({url:"api/dept/superior",method:"post",data:t})}function r(e){return Object(n["a"])({url:"api/dept",method:"post",data:e})}function o(e){return Object(n["a"])({url:"api/dept",method:"delete",data:e})}function s(e){return Object(n["a"])({url:"api/dept",method:"put",data:e})}t["a"]={add:r,edit:s,del:o,getDepts:i,getDeptSuperior:l}},c6d8:function(e,t,a){},e015:function(e,t,a){},ee16:function(e,t,a){"use strict";var n=a("a3a3");a("63d4");function i(e){return Object(n["a"])({url:"api/users",method:"get",params:e})}function l(e){return Object(n["a"])({url:"api/users",method:"post",data:e})}function r(e){return Object(n["a"])({url:"api/users",method:"delete",data:e})}function o(e){return Object(n["a"])({url:"api/users",method:"put",data:e})}t["b"]={get:i,add:l,edit:o,del:r}}}]);