(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4af5ab43"],{1872:function(e,t,n){"use strict";n("6bcd")},1963:function(e,t,n){},"1fc5":function(e,t,n){},"5ffc":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return s}));var i=n("a3a3");function a(){return Object(i["a"])({url:"api/roles/all",method:"get"})}function r(e){return Object(i["a"])({url:"api/roles",method:"get",params:e})}function o(e){return Object(i["a"])({url:"api/roles",method:"post",data:e})}function l(e){return Object(i["a"])({url:"api/roles/"+e,method:"get"})}function s(){return Object(i["a"])({url:"api/roles/level",method:"get"})}function c(e){return Object(i["a"])({url:"api/roles",method:"delete",data:e})}function u(e){return Object(i["a"])({url:"api/roles",method:"put",data:e})}function d(e){return Object(i["a"])({url:"api/roles/menu",method:"put",data:e})}t["a"]={getList:r,add:o,edit:u,del:c,get:l,editMenu:d,getLevel:s}},"6bcd":function(e,t,n){},a1fd:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-card",{staticClass:"box-card"},[n("div",[n("el-row",[n("span",[e._v("角色名：")]),e._v(" "),n("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入角色名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handlesearch(t)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.handlesearch}},[e._v("查询")]),e._v(" "),n("el-button",{on:{click:e.resetData}},[e._v("重置")])],1),e._v(" "),n("el-row",[n("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("添加")]),e._v(" "),n("el-button",{attrs:{disabled:0===e.ids.length,type:"danger",size:"small"},on:{click:function(t){e.deleteVisible=!0}}},[e._v("删除")])],1)],1),e._v(" "),n("div",[n("el-row",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id","highlight-current-row":""},on:{"current-change":e.tableCurrentChange,"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{prop:"id",label:"编号",width:"80"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"角色名",width:"100"}}),e._v(" "),n("el-table-column",{attrs:{prop:"dataScope",label:"数据权限"}}),e._v(" "),n("el-table-column",{attrs:{prop:"level",label:"角色级别"}}),e._v(" "),n("el-table-column",{attrs:{prop:"description",label:"描述",width:"200"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),n("el-row",[n("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":e.pagesizes,"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.visible,width:"650px","show-close":!1,"destroy-on-close":!0},on:{"update:visible":function(t){e.visible=t}}},[n("el-col",{attrs:{span:24}},[n("el-form",{ref:"form",attrs:{inline:!0,model:e.form,rules:e.rules,size:"small","label-width":"80px"}},[n("el-form-item",{attrs:{label:"角色名",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入角色名",clearable:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色级别",prop:"level",size:"mini"}},[n("el-input-number",{attrs:{min:1,max:999,clearable:""},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"数据权限",prop:"dataScopes"}},[n("el-select",{attrs:{placeholder:"请选择数据权限"},on:{change:e.changeScope},model:{value:e.form.dataScope,callback:function(t){e.$set(e.form,"dataScope",t)},expression:"form.dataScope"}},e._l(e.dataScopes,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"描述",prop:"description",size:"mini"}},[n("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),"自定义"===e.form.dataScope?n("el-form-item",{attrs:{label:"数据权限",prop:"depts"}},[n("treeselect",{staticStyle:{width:"480px"},attrs:{"load-options":e.loadDepts,options:e.depts,multiple:"",placeholder:"请选择"},model:{value:e.form.depts,callback:function(t){e.$set(e.form,"depts",t)},expression:"form.depts"}})],1):e._e(),e._v(" "),null!==e.form.id?n("el-form-item",{attrs:{label:"菜单权限"}},[n("treeselect",{staticStyle:{width:"480px"},attrs:{options:e.menus,"default-expand-level":1,"load-options":e.loadMenus,"value-consists-of":e.valueConsistsOf,multiple:"",placeholder:"请选择菜单"},model:{value:e.roleMenus,callback:function(t){e.roleMenus=t},expression:"roleMenus"}})],1):e._e()],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")]),e._v(" "),n("el-button",{on:{click:e.closeForm}},[e._v("取 消")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"确认删除",visible:e.deleteVisible,width:"400px","show-close":!1,"destroy-on-close":!0},on:{"update:visible":function(t){e.deleteVisible=t}}},[n("el-col",{attrs:{span:22}},[n("span",[e._v("确认删除选中项？")])]),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.deleteData}},[e._v("确 定")]),e._v(" "),n("el-button",{on:{click:e.closeForm}},[e._v("取 消")])],1)],1)],1)],1)},a=[],r=(n("c5f6"),n("ac6a"),n("7f7f"),n("5ffc")),o=n("af36"),l=n("69aa"),s=n("ca17"),c=n.n(s),u=(n("542c"),n("5c96")),d={name:"Role",components:{Treeselect:c.a},data:function(){return{name:"",dialogTitle:"",valueConsistsOf:"ALL",visible:!1,deleteVisible:!1,save:!1,listLoading:!0,pagesizes:[5,10,15,20],pagesize:5,currentPage:1,tableData:[],treeData:[],roleMenus:[],delateDatas:[],props:{children:"children",label:"label",isLeaf:"leaf"},total:0,dataScopes:["全部","本级","自定义"],rules:{name:[{type:"string",required:!0,message:"名称不能为空",trigger:"blur"}],description:[{type:"string",required:!0,message:"请输入描述",trigger:"blur"}]},defaultForm:{id:null,name:null,depts:[],description:null,dataScope:"全部",level:3},form:null,row:null,menus:[],depts:[],ids:[]}},created:function(){this.fetchData(),this.form=JSON.parse(JSON.stringify(this.defaultForm)),this.row=JSON.parse(JSON.stringify(this.defaultForm))},methods:{fetchData:function(){var e=this;this.ids=[],this.listLoading=!0;var t=this.currentPage-1,n=this.pagesize,i="level,asc",a=this.name,o=null;o={page:t,size:n,sort:i,blurry:a},r["a"].getList(o).then((function(t){e.tableData=t.content,e.total=t.totalElements,(e.currentPage-1)*e.pagesize>=e.total&&e.currentPage>1&&(e.currentPage-=1,e.fetchData()),e.listLoading=!1}))},handleSizeChange:function(e){this.pagesize=e},handleCurrentChange:function(e){this.currentPage=e},tableCurrentChange:function(e){},handleAdd:function(){this.dialogTitle="新增角色",this.form=JSON.parse(JSON.stringify(this.defaultForm)),this.roleMenus=[],this.getMenus(),this.visible=!0},handleEdit:function(e,t){if(this.dialogTitle="编辑角色",this.form=JSON.parse(JSON.stringify(t)),this.roleMenus=[],"自定义"===this.form.dataScope&&(null===this.form.id?this.getDepts():this.getSupDepts(this.form.depts)),null===this.form.id)this.getMenus();else{this.getSupMenus(this.form.menus);var n=[];this.form.menus.forEach((function(e){n.push(e.id)})),this.roleMenus=n}var i=[];this.form.depts.forEach((function(e){i.push(e.id)})),this.form.depts=i,this.visible=!0},handleDelete:function(e,t){this.form=JSON.parse(JSON.stringify(t)),this.ids=[this.form.id],this.deleteVisible=!0},handlesearch:function(){this.listLoading=!0,this.fetchData()},update:function(){var e=this;this.$refs["form"].validate((function(t){if("自定义"===e.form.dataScope&&0===e.form.depts.length)e.$message({message:"自定义数据权限不能为空",type:"warning"});else if(t){if(e.listLoading=!0,"自定义"===e.form.dataScope){var n=[];e.form.depts.forEach((function(e){var t={id:e};n.push(t)})),e.form.depts=n}else e.form.depts=[];null===e.form.id?r["a"].add(e.form).then((function(t){e.notifiSuccess("新增成功"),e.closeForm(),e.fetchData()})).catch((function(){e.notifiError("新增失败"),e.closeForm(),e.fetchData()})):r["a"].edit(e.form).then((function(t){e.notifiSuccess("编辑成功"),e.saveMenu(),e.closeForm(),e.fetchData()})).catch((function(){e.notifiError("编辑失败"),e.closeForm(),e.fetchData()}))}}))},deleteData:function(){var e=this;r["a"].del(this.ids).then((function(t){e.row=JSON.parse(JSON.stringify(e.defaultForm)),e.$refs.table.setCurrentRow(),e.notifiSuccess("删除成功"),e.fetchData()})).catch((function(){e.notifiError("删除失败")})),this.closeForm()},closeForm:function(){this.visible=!1,this.deleteVisible=!1,this.ids=[],this.form=JSON.parse(JSON.stringify(this.defaultForm))},setTreeData:function(e,t){var n=JSON.parse(JSON.stringify(e));return n.filter((function(e){var i=n.filter((function(t){return Number(e.id)===Number(t.fatherId)}));return i.length>0?e.children=i:e.children=[],e.fatherId===t}))},resetData:function(){this.listLoading=!0,this.name="",this.form=JSON.parse(JSON.stringify(this.defaultForm)),this.row=JSON.parse(JSON.stringify(this.defaultForm)),this.$refs.table.setCurrentRow(),this.fetchData()},normalizer:function(e){return{label:e.name,value:e.id,key:e.id}},filterNode:function(e,t){return!e||-1!==e.indexOf(t.id)},getDepts:function(){var e=this;Object(o["c"])({enabled:!0}).then((function(t){e.depts=t.content.map((function(e){return e.hasChildren&&(e.children=null),e}))}))},getSupDepts:function(e){var t=this,n=[];e.forEach((function(e){n.push(e.id)})),Object(o["b"])(n).then((function(e){var n=e.content;t.buildDepts(n),t.depts=n}))},buildDepts:function(e){var t=this;e.forEach((function(e){e.children&&t.buildDepts(e.children),e.hasChildren&&!e.children&&(e.children=null)}))},loadDepts:function(e){var t=e.action,n=e.parentNode,i=e.callback;t===s["LOAD_CHILDREN_OPTIONS"]&&Object(o["c"])({enabled:!0,pid:n.id}).then((function(e){n.children=e.content.map((function(e){return e.hasChildren&&(e.children=null),e})),setTimeout((function(){i()}),200)}))},getMenus:function(){var e=this;Object(l["d"])({enabled:!0}).then((function(t){e.menus=t.content.map((function(e){return e.hasChildren&&(e.children=null),e}))}))},getSupMenus:function(e){var t=this,n=[];e.forEach((function(e){n.push(e.id)})),Object(l["c"])(n).then((function(e){var n=e;t.buildMenus(n),t.menus=n}))},buildMenus:function(e){var t=this;e.forEach((function(e){e.children&&t.buildMenus(e.children),e.hasChildren&&!e.children&&(e.children=null)}))},loadMenus:function(e){var t=e.action,n=e.parentNode,i=e.callback;t===s["LOAD_CHILDREN_OPTIONS"]&&Object(l["d"])({enabled:!0,pid:n.id}).then((function(e){n.children=e.content.map((function(e){return e.hasChildren&&(e.children=null),e})),setTimeout((function(){i()}),200)}))},changeScope:function(){"自定义"===this.form.dataScope&&this.getDepts()},handleSelectionChange:function(e){var t=[];e.forEach((function(e){t.push(e.id)})),this.ids=t},saveMenu:function(){var e=this;this.menuLoading=!0;var t={id:this.form.id,menus:[]};this.roleMenus.forEach((function(e){var n={id:e};t.menus.push(n)})),this.$refs.table.setCurrentRow(),r["a"].editMenu(t).then((function(){e.notifiSuccess("编辑菜单成功")})).catch((function(){e.notifiError("编辑菜单失败")}))},notifiSuccess:function(e){u["Notification"].success({title:e,duration:4e3})},notifiError:function(e){u["Notification"].error({title:e,duration:4e3})}}},f=d,h=(n("f68a"),n("1872"),n("e298"),n("2877")),p=Object(h["a"])(f,i,a,!1,null,"42c12ca6",null);t["default"]=p.exports},aa77:function(e,t,n){var i=n("5ca1"),a=n("be13"),r=n("79e5"),o=n("fdef"),l="["+o+"]",s="​",c=RegExp("^"+l+l+"*"),u=RegExp(l+l+"*$"),d=function(e,t,n){var a={},l=r((function(){return!!o[e]()||s[e]()!=s})),c=a[e]=l?t(f):o[e];n&&(a[n]=c),i(i.P+i.F*l,"String",a)},f=d.trim=function(e,t){return e=String(a(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=d},af36:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return r}));n("e804");var i=n("a3a3");function a(e){return Object(i["a"])({url:"api/dept",method:"get",params:e})}function r(e){var t=e.length||0===e.length?e:Array.of(e);return Object(i["a"])({url:"api/dept/superior",method:"post",data:t})}function o(e){return Object(i["a"])({url:"api/dept",method:"post",data:e})}function l(e){return Object(i["a"])({url:"api/dept",method:"delete",data:e})}function s(e){return Object(i["a"])({url:"api/dept",method:"put",data:e})}t["a"]={add:o,edit:s,del:l,getDepts:a,getDeptSuperior:r}},c5f6:function(e,t,n){"use strict";var i=n("7726"),a=n("69a8"),r=n("2d95"),o=n("5dbc"),l=n("6a99"),s=n("79e5"),c=n("9093").f,u=n("11e9").f,d=n("86cc").f,f=n("aa77").trim,h="Number",p=i[h],m=p,b=p.prototype,g=r(n("2aeb")(b))==h,v="trim"in String.prototype,S=function(e){var t=l(e,!1);if("string"==typeof t&&t.length>2){t=v?t.trim():f(t,3);var n,i,a,r=t.charCodeAt(0);if(43===r||45===r){if(n=t.charCodeAt(2),88===n||120===n)return NaN}else if(48===r){switch(t.charCodeAt(1)){case 66:case 98:i=2,a=49;break;case 79:case 111:i=8,a=55;break;default:return+t}for(var o,s=t.slice(2),c=0,u=s.length;c<u;c++)if(o=s.charCodeAt(c),o<48||o>a)return NaN;return parseInt(s,i)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(g?s((function(){b.valueOf.call(n)})):r(n)!=h)?o(new m(S(t)),n,p):S(t)};for(var _,O=n("9e1e")?c(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),N=0;O.length>N;N++)a(m,_=O[N])&&!a(p,_)&&d(p,_,u(m,_));p.prototype=b,b.constructor=p,n("2aba")(i,h,p)}},e298:function(e,t,n){"use strict";n("1963")},f68a:function(e,t,n){"use strict";n("1fc5")},fdef:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);